import{d as te,Y as H,Z as se,r as z,p as W,C as E,M as Te,a as i,c as re,$ as le,a0 as Y,a1 as Ue,n as ie,O as be,a2 as _e,m as X,t as U,G as Z,a3 as de,a4 as pe,L as Be,E as ce,a5 as G,a6 as De,a7 as Fe,N as ye,H as Ne,I as q,a8 as Ce,y as Ae,z as oe,w as Ie,a9 as Pe,aa as Le,ab as Ye,ac as xe,ad as Me,ae as Xe,R as ve,S as me,af as Ze,_ as Ee,b as $e,e as p,h as Q,i as fe,o as je,W as He}from"./index-BgoBg-8v.js";import{L as Se,B as We}from"./index-DXTB2081.js";import{c as Ge,a as ue,b as qe,P as Ke,S as Je,m as Qe,u as ea,F as aa,C as oa,T as ee}from"./index-CSuI6rcM.js";import{I as ke}from"./index-DwWi7oEr.js";const ge=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),ta=e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}),ne=re("image-preview")[1],we=2.6,la={src:String,show:Boolean,active:Number,minZoom:H(ie),maxZoom:H(ie),rootWidth:H(Number),rootHeight:H(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickImage:Boolean,closeOnClickOverlay:Boolean,vertical:Boolean};var na=te({props:la,emits:["scale","close","longPress"],setup(e,{emit:n,slots:u}){const a=se({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),s=Ge(),d=z(),P=z(),I=z(!1),C=z(!1);let V=0;const r=W(()=>{const{scale:o,moveX:c,moveY:m,moving:k,zooming:T,initializing:N}=a,J={transitionDuration:T||k||N?"0s":".3s"};return(o!==1||C.value)&&(J.transform=`matrix(${o}, 0, 0, ${o}, ${c}, ${m})`),J}),t=W(()=>{if(a.imageRatio){const{rootWidth:o,rootHeight:c}=e,m=I.value?c/a.imageRatio:o;return Math.max(0,(a.scale*m-o)/2)}return 0}),h=W(()=>{if(a.imageRatio){const{rootWidth:o,rootHeight:c}=e,m=I.value?c:o*a.imageRatio;return Math.max(0,(a.scale*m-c)/2)}return 0}),g=(o,c)=>{var m;if(o=Y(o,+e.minZoom,+e.maxZoom+1),o!==a.scale){const k=o/a.scale;if(a.scale=o,c){const T=be((m=d.value)==null?void 0:m.$el),N={x:T.width*.5,y:T.height*.5},J=a.moveX-(c.x-T.left-N.x)*(k-1),Oe=a.moveY-(c.y-T.top-N.y)*(k-1);a.moveX=Y(J,-t.value,t.value),a.moveY=Y(Oe,-h.value,h.value)}else a.moveX=0,a.moveY=C.value?V:0;n("scale",{scale:o,index:e.active})}},x=()=>{g(1)},A=()=>{const o=a.scale>1?1:2;g(o,o===2||C.value?{x:s.startX.value,y:s.startY.value}:void 0)};let w,D,F,f,O,R,L,$,l=!1;const v=o=>{const{touches:c}=o;if(w=c.length,w===2&&e.disableZoom)return;const{offsetX:m}=s;s.start(o),D=a.moveX,F=a.moveY,$=Date.now(),l=!1,a.moving=w===1&&(a.scale!==1||C.value),a.zooming=w===2&&!m.value,a.zooming&&(f=a.scale,O=ge(c))},S=o=>{const{touches:c}=o;if(s.move(o),a.moving){const{deltaX:m,deltaY:k}=s,T=m.value+D,N=k.value+F;if((e.vertical?s.isVertical()&&Math.abs(N)>h.value:s.isHorizontal()&&Math.abs(T)>t.value)&&!l){a.moving=!1;return}l=!0,le(o,!0),a.moveX=Y(T,-t.value,t.value),a.moveY=Y(N,-h.value,h.value)}if(a.zooming&&(le(o,!0),c.length===2)){const m=ge(c),k=f*m/O;R=ta(c),g(k,R)}},b=o=>{var c;const m=(c=P.value)==null?void 0:c.$el;if(!m)return;const k=m.firstElementChild,T=o.target===m,N=k?.contains(o.target);!e.closeOnClickImage&&N||!e.closeOnClickOverlay&&T||n("close")},_=o=>{if(w>1)return;const c=Date.now()-$,m=250;s.isTap.value&&(c<m?e.doubleScale?L?(clearTimeout(L),L=null,A()):L=setTimeout(()=>{b(o),L=null},m):b(o):c>_e&&n("longPress"))},B=o=>{let c=!1;if((a.moving||a.zooming)&&(c=!0,a.moving&&D===a.moveX&&F===a.moveY&&(c=!1),!o.touches.length)){a.zooming&&(a.moveX=Y(a.moveX,-t.value,t.value),a.moveY=Y(a.moveY,-h.value,h.value),a.zooming=!1),a.moving=!1,D=0,F=0,f=1,a.scale<1&&x();const m=+e.maxZoom;a.scale>m&&g(m,R)}le(o,c),_(o),s.reset()},K=()=>{const{rootWidth:o,rootHeight:c}=e,m=c/o,{imageRatio:k}=a;I.value=a.imageRatio>m&&k<we,C.value=a.imageRatio>m&&k>=we,C.value&&(V=(k*o-c)/2,a.moveY=V,a.initializing=!0,Ue(()=>{a.initializing=!1})),x()},j=o=>{const{naturalWidth:c,naturalHeight:m}=o.target;a.imageRatio=m/c,K()};return E(()=>e.active,x),E(()=>e.show,o=>{o||x()}),E(()=>[e.rootWidth,e.rootHeight],K),Te("touchmove",S,{target:W(()=>{var o;return(o=P.value)==null?void 0:o.$el})}),ue({resetScale:x}),()=>{const o={loading:()=>i(Se,{type:"spinner"},null)};return i(qe,{ref:P,class:ne("swipe-item"),onTouchstartPassive:v,onTouchend:B,onTouchcancel:B},{default:()=>[u.image?i("div",{class:ne("image-wrap")},[u.image({src:e.src,onLoad:j,style:r.value})]):i(ke,{ref:d,src:e.src,fit:"contain",class:ne("image",{vertical:I.value}),style:r.value,onLoad:j},o)]})}}});const[ia,M]=re("image-preview"),sa=["show","teleport","transition","overlayStyle","closeOnPopstate"],ra={show:Boolean,loop:U,images:pe(),minZoom:Z(1/3),maxZoom:Z(3),overlay:U,vertical:Boolean,closeable:Boolean,showIndex:U,className:de,closeIcon:X("clear"),transition:String,beforeClose:Function,doubleScale:U,overlayClass:de,overlayStyle:Object,swipeDuration:Z(300),startPosition:Z(0),showIndicators:Boolean,closeOnPopstate:U,closeOnClickImage:U,closeOnClickOverlay:U,closeIconPosition:X("top-right"),teleport:[String,Object]};var Re=te({name:ia,props:ra,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:n,slots:u}){const a=z(),s=z(),d=se({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),P=()=>{if(a.value){const f=be(a.value.$el);d.rootWidth=f.width,d.rootHeight=f.height,a.value.resize()}},I=f=>n("scale",f),C=f=>n("update:show",f),V=()=>{Ce(e.beforeClose,{args:[d.active],done:()=>C(!1)})},r=f=>{f!==d.active&&(d.active=f,n("change",f))},t=()=>{if(e.showIndex)return i("div",{class:M("index")},[u.index?u.index({index:d.active}):`${d.active+1} / ${e.images.length}`])},h=()=>{if(u.cover)return i("div",{class:M("cover")},[u.cover()])},g=()=>{d.disableZoom=!0},x=()=>{d.disableZoom=!1},A=()=>i(Je,{ref:a,lazyRender:!0,loop:e.loop,class:M("swipe"),vertical:e.vertical,duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:r,onDragEnd:x,onDragStart:g},{default:()=>[e.images.map((f,O)=>i(na,{ref:R=>{O===d.active&&(s.value=R)},src:f,show:e.show,active:d.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:d.rootWidth,rootHeight:d.rootHeight,disableZoom:d.disableZoom,doubleScale:e.doubleScale,closeOnClickImage:e.closeOnClickImage,closeOnClickOverlay:e.closeOnClickOverlay,vertical:e.vertical,onScale:I,onClose:V,onLongPress:()=>n("longPress",{index:O})},{image:u.image}))]}),w=()=>{if(e.closeable)return i(q,{role:"button",name:e.closeIcon,class:[M("close-icon",e.closeIconPosition),Ne],onClick:V},null)},D=()=>n("closed"),F=(f,O)=>{var R;return(R=a.value)==null?void 0:R.swipeTo(f,O)};return ue({resetScale:()=>{var f;(f=s.value)==null||f.resetScale()},swipeTo:F}),Be(P),E([De,Fe],P),E(()=>e.startPosition,f=>r(+f)),E(()=>e.show,f=>{const{images:O,startPosition:R}=e;f?(r(+R),ye(()=>{P(),F(+R,{immediate:!0})})):n("close",{index:d.active,url:O[d.active]})}),()=>i(Ke,ce({class:[M(),e.className],overlayClass:[M("overlay"),e.overlayClass],onClosed:D,"onUpdate:show":C},G(e,sa)),{default:()=>[w(),A(),t(),h()]})}});let ae;const ca={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,vertical:!1,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,doubleScale:!0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeOnClickOverlay:!0,closeIconPosition:"top-right"};function ua(){({instance:ae}=Qe({setup(){const{state:e,toggle:n}=ea(),u=()=>{e.images=[]};return()=>i(Re,ce(e,{onClosed:u,"onUpdate:show":n}),null)}}))}const da=(e,n=0)=>{if(Ae)return ae||ua(),e=Array.isArray(e)?{images:e,startPosition:n}:e,ae.open(oe({},ca,e)),ae};Ie(Re);const[va,y,ma]=re("uploader");function he(e,n){return new Promise(u=>{if(n==="file"){u();return}const a=new FileReader;a.onload=s=>{u(s.target.result)},n==="dataUrl"?a.readAsDataURL(e):n==="text"&&a.readAsText(e)})}function Ve(e,n){return Pe(e).some(u=>u.file?Le(n)?n(u.file):u.file.size>+n:!1)}function fa(e,n){const u=[],a=[];return e.forEach(s=>{Ve(s,n)?a.push(s):u.push(s)}),{valid:u,invalid:a}}const ga=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg|avif)/i,wa=e=>ga.test(e);function ze(e){return e.isImage?!0:e.file&&e.file.type?e.file.type.indexOf("image")===0:e.url?wa(e.url):typeof e.content=="string"?e.content.indexOf("data:image")===0:!1}var ha=te({props:{name:ie,item:H(Object),index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,reupload:Boolean,previewSize:[Number,String,Array],beforeDelete:Function},emits:["delete","preview","reupload"],setup(e,{emit:n,slots:u}){const a=()=>{const{status:r,message:t}=e.item;if(r==="uploading"||r==="failed"){const h=r==="failed"?i(q,{name:"close",class:y("mask-icon")},null):i(Se,{class:y("loading")},null),g=Ye(t)&&t!=="";return i("div",{class:y("mask")},[h,g&&i("div",{class:y("mask-message")},[t])])}},s=r=>{const{name:t,item:h,index:g,beforeDelete:x}=e;r.stopPropagation(),Ce(x,{args:[h,{name:t,index:g}],done:()=>n("delete")})},d=()=>n("preview"),P=()=>n("reupload"),I=()=>{if(e.deletable&&e.item.status!=="uploading"){const r=u["preview-delete"];return i("div",{role:"button",class:y("preview-delete",{shadow:!r}),tabindex:0,"aria-label":ma("delete"),onClick:s},[r?r():i(q,{name:"cross",class:y("preview-delete-icon")},null)])}},C=()=>{if(u["preview-cover"]){const{index:r,item:t}=e;return i("div",{class:y("preview-cover")},[u["preview-cover"](oe({index:r},t))])}},V=()=>{const{item:r,lazyLoad:t,imageFit:h,previewSize:g,reupload:x}=e;return ze(r)?i(ke,{fit:h,src:r.objectUrl||r.content||r.url,class:y("preview-image"),width:Array.isArray(g)?g[0]:g,height:Array.isArray(g)?g[1]:g,lazyLoad:t,onClick:x?P:d},{default:C}):i("div",{class:y("file"),style:xe(e.previewSize)},[i(q,{class:y("file-icon"),name:"description"},null),i("div",{class:[y("file-name"),"van-ellipsis"]},[r.file?r.file.name:r.url]),C()])};return()=>i("div",{class:y("preview")},[V(),a(),I()])}});const ba={name:Z(""),accept:X("image/*"),capture:String,multiple:Boolean,disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,maxCount:Z(1/0),imageFit:X("cover"),resultType:X("dataUrl"),uploadIcon:X("photograph"),uploadText:String,deletable:U,reupload:Boolean,afterRead:Function,showUpload:U,modelValue:pe(),beforeRead:Function,beforeDelete:Function,previewSize:[Number,String,Array],previewImage:U,previewOptions:Object,previewFullImage:U,maxSize:{type:[Number,String,Function],default:1/0}};var pa=te({name:va,props:ba,emits:["delete","oversize","clickUpload","closePreview","clickPreview","clickReupload","update:modelValue"],setup(e,{emit:n,slots:u}){const a=z(),s=[],d=z(-1),P=z(!1),I=(l=e.modelValue.length)=>({name:e.name,index:l}),C=()=>{a.value&&(a.value.value="")},V=l=>{if(C(),Ve(l,e.maxSize))if(Array.isArray(l)){const v=fa(l,e.maxSize);if(l=v.valid,n("oversize",v.invalid,I()),!l.length)return}else{n("oversize",l,I());return}if(l=se(l),d.value>-1){const v=[...e.modelValue];v.splice(d.value,1,l),n("update:modelValue",v),d.value=-1}else n("update:modelValue",[...e.modelValue,...Pe(l)]);e.afterRead&&e.afterRead(l,I())},r=l=>{const{maxCount:v,modelValue:S,resultType:b}=e;if(Array.isArray(l)){const _=+v-S.length;l.length>_&&(l=l.slice(0,_)),Promise.all(l.map(B=>he(B,b))).then(B=>{const K=l.map((j,o)=>{const c={file:j,status:"",message:"",objectUrl:URL.createObjectURL(j)};return B[o]&&(c.content=B[o]),c});V(K)})}else he(l,b).then(_=>{const B={file:l,status:"",message:"",objectUrl:URL.createObjectURL(l)};_&&(B.content=_),V(B)})},t=l=>{const{files:v}=l.target;if(e.disabled||!v||!v.length)return;const S=v.length===1?v[0]:[].slice.call(v);if(e.beforeRead){const b=e.beforeRead(S,I());if(!b){C();return}if(Ze(b)){b.then(_=>{r(_||S)}).catch(C);return}}r(S)};let h;const g=()=>n("closePreview"),x=l=>{if(e.previewFullImage){const v=e.modelValue.filter(ze),S=v.map(b=>(b.objectUrl&&!b.url&&b.status!=="failed"&&(b.url=b.objectUrl,s.push(b.url)),b.url)).filter(Boolean);h=da(oe({images:S,startPosition:v.indexOf(l),onClose:g},e.previewOptions))}},A=()=>{h&&h.close()},w=(l,v)=>{const S=e.modelValue.slice(0);S.splice(v,1),n("update:modelValue",S),n("delete",l,I(v))},D=l=>{P.value=!0,d.value=l,ye(()=>$())},F=()=>{P.value||(d.value=-1),P.value=!1},f=(l,v)=>{const S=["imageFit","deletable","reupload","previewSize","beforeDelete"],b=oe(G(e,S),G(l,S,!0));return i(ha,ce({item:l,index:v,onClick:()=>n(e.reupload?"clickReupload":"clickPreview",l,I(v)),onDelete:()=>w(l,v),onPreview:()=>x(l),onReupload:()=>D(v)},G(e,["name","lazyLoad"]),b),G(u,["preview-cover","preview-delete"]))},O=()=>{if(e.previewImage)return e.modelValue.map(f)},R=l=>n("clickUpload",l),L=()=>{const l=e.modelValue.length<+e.maxCount,v=e.readonly?null:i("input",{ref:a,type:"file",class:y("input"),accept:e.accept,capture:e.capture,multiple:e.multiple&&d.value===-1,disabled:e.disabled,onChange:t,onClick:F},null);return u.default?ve(i("div",{class:y("input-wrapper"),onClick:R},[u.default(),v]),[[me,l]]):ve(i("div",{class:y("upload",{readonly:e.readonly}),style:xe(e.previewSize),onClick:R},[i(q,{name:e.uploadIcon,class:y("upload-icon")},null),e.uploadText&&i("span",{class:y("upload-text")},[e.uploadText]),v]),[[me,e.showUpload&&l]])},$=()=>{a.value&&!e.disabled&&a.value.click()};return Me(()=>{s.forEach(l=>URL.revokeObjectURL(l))}),ue({chooseFile:$,reuploadFile:D,closeImagePreview:A}),Xe(()=>e.modelValue),()=>i("div",{class:y()},[i("div",{class:y("wrapper",{disabled:e.disabled})},[O(),L()])])}});const ya=Ie(pa),Ca={class:"verify-page"},Ia={class:"card id-card"},Pa={class:"id-upload-wrap"},xa={class:"id-upload-center"},Sa={class:"card"},ka={class:"card"},Ra={class:"agreement"},Va={class:"agreement-text"},za={class:"footer"},Oa={__name:"index",setup(e){const n=z([]),u=z([]),a=z(!1),s=z({realName:"",mobile:"",baseName:"",baseCity:""}),d=r=>{console.log("身份证照片",r)},P=r=>{console.log("基地照片",r)},I=W(()=>a.value&&n.value.length===1&&u.value.length>0&&s.value.realName&&s.value.mobile&&s.value.baseName&&s.value.baseCity),C=()=>{ee.loading({message:"提交中...",forbidClick:!0}),setTimeout(()=>{ee.clear(),ee.success("已提交审核")},1200)},V=()=>{ee("这里跳转协议详情页")};return(r,t)=>{const h=ya,g=aa,x=oa,A=We;return je(),$e("div",Ca,[t[13]||(t[13]=p("div",{class:"page-header"},[p("h2",null,"发起前需要完成认证"),p("p",null,"为保障公益真实性，请完成以下信息认证")],-1)),p("div",Ia,[t[7]||(t[7]=p("div",{class:"id-header"},[p("div",{class:"card-title"},"身份认证（必填）"),p("div",{class:"card-desc"},[Q(" 请上传本人"),p("strong",null,"手持身份证正面"),Q("清晰照片 ")])],-1)),p("div",Pa,[p("div",xa,[i(h,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=w=>n.value=w),"max-count":1,"preview-size":[320,160],"upload-text":"上传手持身份证照片","after-read":d},null,8,["modelValue"])])])]),p("div",Sa,[t[8]||(t[8]=p("div",{class:"card-title"},"基地信息",-1)),i(h,{modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=w=>u.value=w),"max-count":3,"preview-size":100,"upload-text":"上传基地照片","after-read":P},null,8,["modelValue"]),i(g,{modelValue:s.value.baseName,"onUpdate:modelValue":t[2]||(t[2]=w=>s.value.baseName=w),placeholder:"基地名称"},null,8,["modelValue"]),i(g,{modelValue:s.value.baseCity,"onUpdate:modelValue":t[3]||(t[3]=w=>s.value.baseCity=w),placeholder:"所在城市"},null,8,["modelValue"])]),p("div",ka,[t[9]||(t[9]=p("div",{class:"card-title"},"个人信息",-1)),i(g,{modelValue:s.value.realName,"onUpdate:modelValue":t[4]||(t[4]=w=>s.value.realName=w),placeholder:"真实姓名"},null,8,["modelValue"]),i(g,{modelValue:s.value.mobile,"onUpdate:modelValue":t[5]||(t[5]=w=>s.value.mobile=w),placeholder:"联系电话",type:"tel"},null,8,["modelValue"])]),p("div",Ra,[i(x,{modelValue:a.value,"onUpdate:modelValue":t[6]||(t[6]=w=>a.value=w),"icon-size":"14px"},{default:fe(()=>[p("span",Va,[t[10]||(t[10]=Q(" 我已阅读并同意 ",-1)),p("span",{class:"link",onClick:He(V,["stop"])}," 《公益发起协议》 ")])]),_:1},8,["modelValue"])]),p("div",za,[i(A,{type:"primary",block:"",round:"",disabled:!I.value,onClick:C},{default:fe(()=>[...t[11]||(t[11]=[Q(" 提交审核 ",-1)])]),_:1},8,["disabled"]),t[12]||(t[12]=p("p",{class:"tip"},"审核通过后即可发起筹粮",-1))])])}}},Da=Ee(Oa,[["__scopeId","data-v-82924c78"]]);export{Da as default};
