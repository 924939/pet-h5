import{x as ie,y as re,z as G,A as de,r as l,C as U,D as ce,a as n,E as ue,d as ve,t as pe,m as fe,G as me,c as ge,J as _e,p as K,K as he,L as X,M as ye,N as ke,O as F,P as we,w as be,Q as xe,_ as Ce,b as C,e,R as Te,i as k,l as r,h,I as Se,S as Pe,k as Re,o as w,F as O,j as V,U as Ae,v as I,V as $,W as E}from"./index-BgoBg-8v.js";import{m as Ke,u as Be,s as Le,a as Me,S as Oe,P as Ve,b as Ie,F as Ee,C as Ue}from"./index-CSuI6rcM.js";import{L as je,B as Ne}from"./index-DXTB2081.js";import{P as Fe}from"./index-DxUZTQ6O.js";const $e=Symbol(),ze=()=>ie($e,null),De={icon:"",type:"text",message:"",className:"",overlay:!1,onClose:void 0,onOpened:void 0,duration:2e3,teleport:"body",iconSize:void 0,iconPrefix:void 0,position:"middle",transition:"van-fade",forbidClick:!1,loadingType:void 0,overlayClass:"",overlayStyle:void 0,closeOnClick:!1,closeOnClickOverlay:!1};let M=[],Ge=!1,z=G({},De);const Xe=new Map;function Ye(o){return de(o)?o:{message:o}}function qe(){const{instance:o}=Ke({setup(){const i=l(""),{open:a,state:c,close:m,toggle:b}=Be(),g=()=>{},u=()=>n(Le,ue(c,{onClosed:g,"onUpdate:show":b}),null);return U(i,_=>{c.message=_}),ce().render=u,{open:a,close:m,message:i}}});return o}function He(){if(!M.length||Ge){const o=qe();M.push(o)}return M[M.length-1]}function D(o={}){if(!re)return{};const i=He(),a=Ye(o);return i.open(G({},z,Xe.get(a.type||z.type),a)),i}const[Je,T,Qe]=ge("list"),We={error:Boolean,offset:me(300),loading:Boolean,disabled:Boolean,finished:Boolean,scroller:Object,errorText:String,direction:fe("down"),loadingText:{type:String,default:""},finishedText:String,immediateCheck:pe};var Ze=ve({name:Je,props:We,emits:["load","update:error","update:loading"],setup(o,{emit:i,slots:a}){const c=l(o.loading),m=l(),b=l(),g=ze(),u=_e(m),_=K(()=>o.scroller||u.value),v=()=>{ke(()=>{if(c.value||o.finished||o.disabled||o.error||g?.value===!1)return;const{direction:d}=o,p=+o.offset,f=F(_);if(!f.height||we(m))return;let y=!1;const R=F(b);d==="up"?y=f.top-R.top<=p:y=R.bottom-f.bottom<=p,y&&(c.value=!0,i("update:loading",!0),i("load"))})},S=()=>{if(o.finished){const d=a.finished?a.finished():o.finishedText;if(d)return n("div",{class:T("finished-text")},[d])}},P=()=>{i("update:error",!1),v()},B=()=>{if(o.error){const d=a.error?a.error():o.errorText;if(d)return n("div",{role:"button",class:T("error-text"),tabindex:0,onClick:P},[d])}},L=()=>{if(c.value&&!o.finished&&!o.disabled)return n("div",{class:T("loading")},[a.loading?a.loading():o.loadingText!=null&&n(je,{class:T("loading-icon")},{default:()=>[o.loadingText||Qe("loading")]})])};return U(()=>[o.loading,o.finished,o.error],v),g&&U(g,d=>{d&&v()}),he(()=>{c.value=o.loading}),X(()=>{o.immediateCheck&&v()}),Me({check:v}),ye("scroll",v,{target:_,passive:!0}),()=>{var d;const p=(d=a.default)==null?void 0:d.call(a),f=n("div",{ref:b,class:T("placeholder")},null);return n("div",{ref:m,role:"feed",class:T(),"aria-busy":c.value},[o.direction==="down"?p:f,L(),S(),B(),o.direction==="up"?p:f])}}});const et=be(Ze),tt=xe("support",{state:()=>({rewards:[{key:"p",label:"100 积分",amount:10,foodKg:2,foodType:"狗粮",count:1},{key:"10",label:"¥10",amount:10,foodKg:2,foodType:"狗粮",count:1},{key:"20",label:"¥20",amount:20,foodKg:4,foodType:"猫粮",count:1},{key:"30",label:"¥20",amount:20,foodKg:4,foodType:"猫粮",count:1},{key:"40",label:"¥20",amount:20,foodKg:4,foodType:"猫粮",count:1},{key:"50",label:"¥20",amount:20,foodKg:4,foodType:"猫粮",count:1},{key:"60",label:"¥20",amount:20,foodKg:4,foodType:"猫粮",count:1}],selectedKey:"p"}),getters:{selectedReward(o){return o.rewards.find(i=>i.key===o.selectedKey)},totalAmount(){return this.selectedReward?this.selectedReward.amount*this.selectedReward.count:0}},actions:{selectReward(o){this.selectedKey=o.key},changeCount(o,i){o.count+i<1||(o.count+=i)}}}),ot=["src"],st={class:"card"},nt={class:"title-row"},at={class:"title"},lt={class:"auth"},it={class:"progress-info"},rt={class:"money"},dt={class:"percent"},ct={class:"support-count"},ut={class:"card"},vt={class:"desc"},pt={class:"card"},ft={class:"verify-header"},mt={class:"card"},gt=["src"],_t={class:"support-info"},ht={class:"support-top"},yt={class:"nickname"},kt={class:"level"},wt={class:"amount"},bt={class:"comment"},xt={class:"bottom-bar"},Ct={class:"popup"},Tt={class:"popup-content"},St={class:"points"},Pt=["onClick"],Rt={class:"reward-price"},At={class:"reward-food"},Kt={class:"donate-bar"},Bt={class:"donate-info"},Lt={class:"donate-amount"},Mt={__name:"index",setup(o){const i=Re(),a=tt(),c=l(null),m=l(!1),b=()=>{m.value=c.value.scrollTop>400},g=()=>{c.value.scrollTo({top:0,behavior:"smooth"})},u=l({name:"流浪动物救助基地",targetAmount:5e4,currentAmount:18600,desc:"基地长期致力于流浪动物的救助、治疗和领养。",images:["https://picsum.photos/400/300?1","https://picsum.photos/400/300?2"]}),_=l(u.value.currentAmount),v=K(()=>Math.floor(_.value/u.value.targetAmount*100)),S=l([]),P=l(!1),B=l(!1),L=l(48),d=()=>{setTimeout(()=>{S.value.push(...new Array(10).fill(0).map(()=>({avatar:"https://fastly.jsdelivr.net/npm/@vant/assets/cat.jpeg",nickname:"爱心用户",level:Math.ceil(Math.random()*6),amount:[10,20,30][Math.floor(Math.random()*3)],comment:"愿毛孩子都能被温柔以待"}))),P.value=!1,S.value.length>=L.value&&(B.value=!0)},600)},p=l(!1),f=l(""),y=l(!1),R=l(null),Y=l(320),q=K(()=>a.rewards),H=K(()=>a.selectedKey),J=K(()=>a.totalAmount),Q=a.selectReward,j=a.changeCount,W=()=>{if(!y.value){D({message:"请先阅读并同意公益支持协议",duration:2e3}),R.value?.scrollIntoView({behavior:"smooth",block:"center"});return}i.push("/project")},Z=()=>{D("查看认证详情")};return X(d),(Ot,t)=>{const ee=Ie,te=Oe,A=Se,oe=Fe,se=et,N=Ne,ne=Ee,ae=Ue,le=Ve;return w(),C("div",{class:"detail-page",ref_key:"pageRef",ref:c,onScrollPassive:b},[n(te,{class:"swipe",autoplay:3e3,"indicator-color":"#ff7a00"},{default:k(()=>[(w(!0),C(O,null,V(u.value.images,(s,x)=>(w(),Ae(ee,{key:x},{default:k(()=>[e("img",{src:s,class:"swipe-img"},null,8,ot)]),_:2},1024))),128))]),_:1}),e("div",st,[e("div",nt,[e("div",at,r(u.value.name),1),e("div",lt,[n(A,{name:"passed",color:"#07c160"}),t[6]||(t[6]=h(" 已认证 ",-1))])]),e("div",it,[e("div",rt,[h(" ¥"+r(_.value)+" ",1),e("span",null,"/ ¥"+r(u.value.targetAmount),1)]),e("div",dt,r(v.value)+"%",1)]),n(oe,{percentage:v.value,"stroke-width":"8",color:"#ff7a00","pivot-text":""},null,8,["percentage"]),e("div",ct,r(L.value)+" 人已支持",1)]),e("div",ut,[t[7]||(t[7]=e("div",{class:"card-title"},"基地介绍",-1)),e("div",vt,r(u.value.desc),1)]),e("div",pt,[e("div",ft,[n(A,{name:"certificate",color:"#07c160"}),t[8]||(t[8]=h(" 基地真实性认证 ",-1))]),t[9]||(t[9]=e("div",{class:"verify-row"},[e("span",null,"认证机构"),e("span",null,"XX 市公益动物保护协会")],-1)),t[10]||(t[10]=e("div",{class:"verify-row"},[e("span",null,"备案编号"),e("span",null,"GY-2024-0821")],-1)),t[11]||(t[11]=e("div",{class:"verify-tip"},"平台已对基地主体、救助能力进行人工审核",-1)),e("div",{class:"verify-link",onClick:Z},"查看认证详情 →")]),e("div",mt,[t[12]||(t[12]=e("div",{class:"card-title"},"支持记录",-1)),n(se,{loading:P.value,"onUpdate:loading":t[0]||(t[0]=s=>P.value=s),finished:B.value,"finished-text":"没有更多了",onLoad:d},{default:k(()=>[(w(!0),C(O,null,V(S.value,(s,x)=>(w(),C("div",{key:x,class:"support-item"},[e("img",{src:s.avatar,class:"avatar"},null,8,gt),e("div",_t,[e("div",ht,[e("span",yt,r(s.nickname),1),e("span",kt,"Lv"+r(s.level),1),e("span",wt,"¥"+r(s.amount),1)]),e("div",bt,r(s.comment),1)])]))),128))]),_:1},8,["loading","finished"])]),t[20]||(t[20]=e("div",{class:"van-safe-area-bottom"},null,-1)),Te(e("div",{class:"back-top",onClick:g},[n(A,{name:"arrow-up"})],512),[[Pe,m.value]]),e("div",xt,[n(N,{type:"warning",round:"",block:"",onClick:t[1]||(t[1]=s=>p.value=!0)},{default:k(()=>[...t[13]||(t[13]=[h(" 支持一下 ",-1)])]),_:1})]),n(le,{show:p.value,"onUpdate:show":t[5]||(t[5]=s=>p.value=s),position:"bottom",style:{height:"60%"},round:""},{default:k(()=>[e("div",Ct,[e("div",Tt,[t[16]||(t[16]=e("div",{class:"popup-title"},"支持基地",-1)),e("div",St,[t[14]||(t[14]=h(" 我的积分：",-1)),e("b",null,r(Y.value),1)]),(w(!0),C(O,null,V(q.value,s=>(w(),C("div",{key:s.key,class:$(["reward",{active:H.value===s.key}]),onClick:x=>I(Q)(s)},[e("div",null,[e("div",Rt,r(s.label),1),e("div",At," ≈ "+r(s.foodKg)+"kg "+r(s.foodType),1)]),e("div",{class:"count",onClick:t[2]||(t[2]=E(()=>{},["stop"]))},[n(A,{name:"minus",class:$({disabled:s.count<=1}),onClick:E(x=>I(j)(s,-1),["stop"])},null,8,["class","onClick"]),e("span",null,r(s.count),1),n(A,{name:"plus",onClick:E(x=>I(j)(s,1),["stop"])},null,8,["onClick"])])],10,Pt))),128)),n(ne,{modelValue:f.value,"onUpdate:modelValue":t[3]||(t[3]=s=>f.value=s),type:"textarea",rows:"2",autosize:"",placeholder:"说点鼓励的话（可选）"},null,8,["modelValue"]),e("div",{class:"agreement",ref_key:"agreementRef",ref:R},[n(ae,{modelValue:y.value,"onUpdate:modelValue":t[4]||(t[4]=s=>y.value=s),"checked-color":"#fb976d"},{default:k(()=>[...t[15]||(t[15]=[h(" 我已阅读并同意 ",-1),e("span",{class:"link"},"《公益支持协议》",-1)])]),_:1},8,["modelValue"])],512)]),e("div",Kt,[e("div",Bt,[t[18]||(t[18]=e("div",{class:"donate-label"},"合计支持",-1)),e("div",Lt,[t[17]||(t[17]=h(" ¥",-1)),e("span",null,r(J.value),1)])]),n(N,{class:"donate-btn",type:"warning",round:"",onClick:W},{default:k(()=>[...t[19]||(t[19]=[h(" 确认支持 ",-1)])]),_:1})])])]),_:1},8,["show"])],544)}}},jt=Ce(Mt,[["__scopeId","data-v-c575bc2c"]]);export{jt as default};
