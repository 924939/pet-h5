import{c as Y,R as N,Z as Oe,$ as Z,d as j,S as q,a0 as K,O as z,r as M,k as P,U as he,a1 as De,B as be,a as v,a2 as oe,H as ie,t as X,v as G,a3 as pe,a4 as Ve,y as R,C as re,W as ne,X as ye,m as Se,a5 as _e,a6 as H,w as le,a7 as Ee,a8 as Te,a9 as ue,_ as Me,aa as Pe,b as Be,M as Ie,u as Ne,h as A,o as $e,e as S,g as ce}from"./index-XQHuw6kS.js";import{b as Fe,u as J,P as He,F as Ye,C as Ue}from"./mount-component-BP4X7RAX.js";import{L as Ae,B as Re}from"./index-Ce_sgEos.js";import{N as Ke}from"./index-CGOYZT18.js";import{U as je}from"./index-B9KD2M45.js";import{s as F}from"./function-call-DKRt-rT1.js";import"./index-BsxQJAFZ.js";const[Le,I,de]=Y("picker"),xe=e=>e.find(n=>!n.disabled)||e[0];function qe(e,n){const t=e[0];if(t){if(Array.isArray(t))return"multiple";if(n.children in t)return"cascade"}return"default"}function W(e,n){n=Z(n,0,e.length);for(let t=n;t<e.length;t++)if(!e[t].disabled)return t;for(let t=n-1;t>=0;t--)if(!e[t].disabled)return t;return 0}const me=(e,n,t)=>n!==void 0&&e.some(l=>l[t.value]===n);function ae(e,n,t){const l=e.findIndex(h=>h[t.value]===n),i=W(e,l);return e[i]}function ze(e,n,t){const l=[];let i={[n.children]:e},h=0;for(;i&&i[n.children];){const g=i[n.children],T=t.value[h];if(i=Oe(T)?ae(g,T,n):void 0,!i&&g.length){const d=xe(g)[n.value];i=ae(g,d,n)}h++,l.push(g)}return l}function Ge(e){const{transform:n}=window.getComputedStyle(e),t=n.slice(7,n.length-1).split(", ")[5];return Number(t)}function We(e){return N({text:"text",value:"value",children:"children"},e)}const fe=200,ve=300,Ze=15,[we,ee]=Y("picker-column"),ke=Symbol(we);var Xe=j({name:we,props:{value:z,fields:q(Object),options:K(),readonly:Boolean,allowHtml:Boolean,optionHeight:q(Number),swipeDuration:q(z),visibleOptionNum:q(z)},emits:["change","clickOption","scrollInto"],setup(e,{emit:n,slots:t}){let l,i,h,g,T;const d=M(),a=M(),x=M(0),p=M(0),O=Fe(),D=()=>e.options.length,E=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,V=f=>{let y=W(e.options,f);const o=-y*e.optionHeight,u=()=>{y>D()-1&&(y=W(e.options,f));const b=e.options[y][e.fields.value];b!==e.value&&n("change",b)};l&&o!==x.value?T=u:u(),x.value=o},s=()=>e.readonly||!e.options.length,m=f=>{l||s()||(T=null,p.value=fe,V(f),n("clickOption",e.options[f]))},c=f=>Z(Math.round(-f/e.optionHeight),0,D()-1),k=P(()=>c(x.value)),C=(f,y)=>{const o=Math.abs(f/y);f=x.value+o/.003*(f<0?-1:1);const u=c(f);p.value=+e.swipeDuration,V(u)},r=()=>{l=!1,p.value=0,T&&(T(),T=null)},w=f=>{if(!s()){if(O.start(f),l){const y=Ge(a.value);x.value=Math.min(0,y-E())}p.value=0,i=x.value,h=Date.now(),g=i,T=null}},_=f=>{if(s())return;O.move(f),O.isVertical()&&(l=!0,oe(f,!0));const y=Z(i+O.deltaY.value,-(D()*e.optionHeight),e.optionHeight),o=c(y);o!==k.value&&n("scrollInto",e.options[o]),x.value=y;const u=Date.now();u-h>ve&&(h=u,g=y)},B=()=>{if(s())return;const f=x.value-g,y=Date.now()-h;if(y<ve&&Math.abs(f)>Ze){C(f,y);return}const u=c(x.value);p.value=fe,V(u),setTimeout(()=>{l=!1},0)},$=()=>{const f={height:`${e.optionHeight}px`};return e.options.map((y,o)=>{const u=y[e.fields.text],{disabled:b}=y,L=y[e.fields.value],U={role:"button",style:f,tabindex:b?-1:0,class:[ee("item",{disabled:b,selected:L===e.value}),y.className],onClick:()=>m(o)},Ce={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:u};return v("li",U,[t.option?t.option(y,o):v("div",Ce,null)])})};return he(ke),J({stopMomentum:r}),De(()=>{const f=l?Math.floor(-x.value/e.optionHeight):e.options.findIndex(u=>u[e.fields.value]===e.value),y=W(e.options,f),o=-y*e.optionHeight;l&&y<f&&r(),x.value=o}),be("touchmove",_,{target:d}),()=>v("div",{ref:d,class:ee(),onTouchstartPassive:w,onTouchend:B,onTouchcancel:B},[v("ul",{ref:a,style:{transform:`translate3d(0, ${x.value+E()}px, 0)`,transitionDuration:`${p.value}ms`,transitionProperty:p.value?"all":"none"},class:ee("wrapper"),onTransitionend:r},[$()])])}});const[Je]=Y("picker-toolbar"),Q={title:String,cancelButtonText:String,confirmButtonText:String},Qe=["cancel","confirm","title","toolbar"],et=Object.keys(Q);var tt=j({name:Je,props:Q,emits:["confirm","cancel"],setup(e,{emit:n,slots:t}){const l=()=>{if(t.title)return t.title();if(e.title)return v("div",{class:[I("title"),"van-ellipsis"]},[e.title])},i=()=>n("cancel"),h=()=>n("confirm"),g=()=>{var d;const a=(d=e.cancelButtonText)!=null?d:de("cancel");if(!(!t.cancel&&!a))return v("button",{type:"button",class:[I("cancel"),ie],onClick:i},[t.cancel?t.cancel():a])},T=()=>{var d;const a=(d=e.confirmButtonText)!=null?d:de("confirm");if(!(!t.confirm&&!a))return v("button",{type:"button",class:[I("confirm"),ie],onClick:h},[t.confirm?t.confirm():a])};return()=>v("div",{class:I("toolbar")},[t.toolbar?t.toolbar():[g(),l(),T()]])}});const[nt]=Y("picker-group"),at=Symbol(nt);N({tabs:K(),activeTab:G(0),nextStepText:String,showToolbar:X},Q);const se=N({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:G(44),showToolbar:X,swipeDuration:G(1e3),visibleOptionNum:G(6)},Q),ot=N({},se,{columns:K(),modelValue:K(),toolbarPosition:Se("top"),columnsFieldNames:Object});var lt=j({name:Le,props:ot,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:n,slots:t}){const l=M(),i=M(e.modelValue.slice(0)),{parent:h}=he(at),{children:g,linkChildren:T}=pe(ke);T();const d=P(()=>We(e.columnsFieldNames)),a=P(()=>Ve(e.optionHeight)),x=P(()=>qe(e.columns,d.value)),p=P(()=>{const{columns:o}=e;switch(x.value){case"multiple":return o;case"cascade":return ze(o,d.value,i);default:return[o]}}),O=P(()=>p.value.some(o=>o.length)),D=P(()=>p.value.map((o,u)=>ae(o,i.value[u],d.value))),E=P(()=>p.value.map((o,u)=>o.findIndex(b=>b[d.value.value]===i.value[u]))),V=(o,u)=>{if(i.value[o]!==u){const b=i.value.slice(0);b[o]=u,i.value=b}},s=()=>({selectedValues:i.value.slice(0),selectedOptions:D.value,selectedIndexes:E.value}),m=(o,u)=>{V(u,o),x.value==="cascade"&&i.value.forEach((b,L)=>{const U=p.value[L];me(U,b,d.value)||V(L,U.length?U[0][d.value.value]:void 0)}),re(()=>{n("change",N({columnIndex:u},s()))})},c=(o,u)=>{const b={columnIndex:u,currentOption:o};n("clickOption",N(s(),b)),n("scrollInto",b)},k=()=>{g.forEach(u=>u.stopMomentum());const o=s();return re(()=>{const u=s();n("confirm",u)}),o},C=()=>n("cancel",s()),r=()=>p.value.map((o,u)=>v(Xe,{value:i.value[u],fields:d.value,options:o,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:a.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:b=>m(b,u),onClickOption:b=>c(b,u),onScrollInto:b=>{n("scrollInto",{currentOption:b,columnIndex:u})}},{option:t.option})),w=o=>{if(O.value){const u={height:`${a.value}px`},b={backgroundSize:`100% ${(o-a.value)/2}px`};return[v("div",{class:I("mask"),style:b},null),v("div",{class:[_e,I("frame")],style:u},null)]}},_=()=>{const o=a.value*+e.visibleOptionNum,u={height:`${o}px`};return!e.loading&&!O.value&&t.empty?t.empty():v("div",{ref:l,class:I("columns"),style:u},[r(),w(o)])},B=()=>{if(e.showToolbar&&!h)return v(tt,ye(ne(e,et),{onConfirm:k,onCancel:C}),ne(t,Qe))},$=o=>{o.forEach((u,b)=>{u.length&&!me(u,i.value[b],d.value)&&V(b,xe(u)[d.value.value])})};R(p,o=>$(o),{immediate:!0});let f;return R(()=>e.modelValue,o=>{!H(o,i.value)&&!H(o,f)&&(i.value=o.slice(0),f=o.slice(0)),e.modelValue.length===0&&$(p.value)},{deep:!0}),R(i,o=>{H(o,e.modelValue)||(f=o.slice(0),n("update:modelValue",f))},{immediate:!0}),be("touchmove",oe,{target:l}),J({confirm:k,getSelectedOptions:()=>D.value}),()=>{var o,u;return v("div",{class:I()},[e.toolbarPosition==="top"?B():null,e.loading?v(Ae,{class:I("loading")},null):null,(o=t["columns-top"])==null?void 0:o.call(t),_(),(u=t["columns-bottom"])==null?void 0:u.call(t),e.toolbarPosition==="bottom"?B():null])}}});const st=le(lt),[it,rt]=Y("form"),ut={colon:Boolean,disabled:Boolean,readonly:Boolean,required:[Boolean,String],showError:Boolean,labelWidth:z,labelAlign:String,inputAlign:String,scrollToError:Boolean,scrollToErrorPosition:String,validateFirst:Boolean,submitOnEnter:X,showErrorMessage:X,errorMessageAlign:String,validateTrigger:{type:[String,Array],default:"onBlur"}};var ct=j({name:it,props:ut,emits:["submit","failed"],setup(e,{emit:n,slots:t}){const{children:l,linkChildren:i}=pe(Ee),h=s=>s?l.filter(m=>s.includes(m.name)):l,g=s=>new Promise((m,c)=>{const k=[];h(s).reduce((r,w)=>r.then(()=>{if(!k.length)return w.validate().then(_=>{_&&k.push(_)})}),Promise.resolve()).then(()=>{k.length?c(k):m()})}),T=s=>new Promise((m,c)=>{const k=h(s);Promise.all(k.map(C=>C.validate())).then(C=>{C=C.filter(Boolean),C.length?c(C):m()})}),d=s=>{const m=l.find(c=>c.name===s);return m?new Promise((c,k)=>{m.validate().then(C=>{C?k(C):c()})}):Promise.reject()},a=s=>typeof s=="string"?d(s):e.validateFirst?g(s):T(s),x=s=>{typeof s=="string"&&(s=[s]),h(s).forEach(c=>{c.resetValidation()})},p=()=>l.reduce((s,m)=>(s[m.name]=m.getValidationStatus(),s),{}),O=(s,m)=>{l.some(c=>c.name===s?(c.$el.scrollIntoView(m),!0):!1)},D=()=>l.reduce((s,m)=>(m.name!==void 0&&(s[m.name]=m.formValue.value),s),{}),E=()=>{const s=D();a().then(()=>n("submit",s)).catch(m=>{n("failed",{values:s,errors:m});const{scrollToError:c,scrollToErrorPosition:k}=e;c&&m[0].name&&O(m[0].name,k?{block:k}:void 0)})},V=s=>{oe(s),E()};return i({props:e}),J({submit:E,validate:a,getValues:D,scrollToField:O,resetValidation:x,getValidationStatus:p}),()=>{var s;return v("form",{class:rt(),onSubmit:V},[(s=t.default)==null?void 0:s.call(t)])}}});const dt=le(ct),mt=N({},se,{modelValue:K(),filter:Function,formatter:{type:Function,default:(e,n)=>n}}),ft=Object.keys(se);function vt(e,n){if(e<0)return[];const t=Array(e);let l=-1;for(;++l<e;)t[l]=n(l);return t}const gt=(e,n)=>32-new Date(e,n-1,32).getDate(),te=(e,n,t,l,i,h)=>{const g=vt(n-e+1,T=>{const d=Te(e+T);return l(t,{text:d,value:d})});return i?i(t,g,h):g},ht=(e,n)=>e.map((t,l)=>{const i=n[l];if(i.length){const h=+i[0].value,g=+i[i.length-1].value;return Te(Z(+t,h,g))}return t}),ge=new Date().getFullYear(),[bt]=Y("date-picker"),pt=N({},mt,{columnsType:{type:Array,default:()=>["year","month","day"]},minDate:{type:Date,default:()=>new Date(ge-10,0,1),validator:ue},maxDate:{type:Date,default:()=>new Date(ge+10,11,31),validator:ue}});var yt=j({name:bt,props:pt,emits:["confirm","cancel","change","update:modelValue"],setup(e,{emit:n,slots:t}){const l=M(e.modelValue),i=M(!1),h=M(),g=P(()=>i.value?e.modelValue:l.value),T=r=>r===e.minDate.getFullYear(),d=r=>r===e.maxDate.getFullYear(),a=r=>r===e.minDate.getMonth()+1,x=r=>r===e.maxDate.getMonth()+1,p=r=>{const{minDate:w,columnsType:_}=e,B=_.indexOf(r),$=g.value[B];if($)return+$;switch(r){case"year":return w.getFullYear();case"month":return w.getMonth()+1;case"day":return w.getDate()}},O=()=>{const r=e.minDate.getFullYear(),w=e.maxDate.getFullYear();return te(r,w,"year",e.formatter,e.filter,g.value)},D=()=>{const r=p("year"),w=T(r)?e.minDate.getMonth()+1:1,_=d(r)?e.maxDate.getMonth()+1:12;return te(w,_,"month",e.formatter,e.filter,g.value)},E=()=>{const r=p("year"),w=p("month"),_=T(r)&&a(w)?e.minDate.getDate():1,B=d(r)&&x(w)?e.maxDate.getDate():gt(r,w);return te(_,B,"day",e.formatter,e.filter,g.value)},V=()=>{var r;return(r=h.value)==null?void 0:r.confirm()},s=()=>l.value,m=P(()=>e.columnsType.map(r=>{switch(r){case"year":return O();case"month":return D();case"day":return E();default:return[]}}));R(l,r=>{H(r,e.modelValue)||n("update:modelValue",r)}),R(()=>e.modelValue,(r,w)=>{i.value=H(w,l.value),r=ht(r,m.value),H(r,l.value)||(l.value=r),i.value=!1},{immediate:!0});const c=(...r)=>n("change",...r),k=(...r)=>n("cancel",...r),C=(...r)=>n("confirm",...r);return J({confirm:V,getSelectedDate:s}),()=>v(st,ye({ref:h,modelValue:l.value,"onUpdate:modelValue":r=>l.value=r,columns:m.value,onChange:c,onCancel:k,onConfirm:C},ne(e,ft)),t)}});const Tt=le(yt),xt={class:"page"},wt={class:"card"},kt={class:"card"},Ct={class:"card"},Ot={class:"card"},Dt={class:"card"},Vt={class:"footer"},St={__name:"index",setup(e){const n=Ne(),t=Pe({title:"",desc:"",images:[],targetKg:"",startTime:"",endTime:""}),l=M(!1),i=M(!1),h=({selectedValues:d})=>{t.startTime=d.join("-"),l.value=!1},g=({selectedValues:d})=>{t.endTime=d.join("-"),i.value=!1},T=()=>{if(!t.title)return F("请输入活动标题");if(!t.desc)return F("请填写基地介绍");if(t.images.length<2)return F("至少上传 2 张图片");if(!t.targetKg)return F("请输入目标粮食数量");if(!t.startTime||!t.endTime)return F("请选择活动时间");console.log("发布数据：",t),F("发布成功，等待审核"),n.replace("/audit?status=pending")};return(d,a)=>{const x=Ke,p=Ye,O=je,D=Ue,E=Re,V=dt,s=Tt,m=He;return $e(),Be("div",xt,[v(x,{title:"发布筹粮活动","left-text":"返回","left-arrow":"",onClickLeft:a[0]||(a[0]=c=>Ie(n).back())}),v(V,{onSubmit:T},{default:A(()=>[S("div",wt,[a[11]||(a[11]=S("div",{class:"label"},"活动标题",-1)),v(p,{modelValue:t.title,"onUpdate:modelValue":a[1]||(a[1]=c=>t.title=c),placeholder:"请输入活动标题（20字以内）",maxlength:"20","show-word-limit":""},null,8,["modelValue"])]),S("div",kt,[a[12]||(a[12]=S("div",{class:"label"},"基地文字介绍",-1)),v(p,{modelValue:t.desc,"onUpdate:modelValue":a[2]||(a[2]=c=>t.desc=c),type:"textarea",rows:"4",maxlength:"300","show-word-limit":"",placeholder:"介绍基地情况、救助经历等"},null,8,["modelValue"])]),S("div",Ct,[a[13]||(a[13]=S("div",{class:"label"},[ce(" 图片介绍 "),S("span",{class:"sub"},"（最少 2 张，最多 6 张）")],-1)),v(O,{modelValue:t.images,"onUpdate:modelValue":a[3]||(a[3]=c=>t.images=c),"max-count":6,"preview-size":96},null,8,["modelValue"])]),S("div",Ot,[a[15]||(a[15]=S("div",{class:"label"},"活动目标",-1)),v(p,{modelValue:t.targetKg,"onUpdate:modelValue":a[4]||(a[4]=c=>t.targetKg=c),type:"number",placeholder:"请输入目标粮食数量"},{button:A(()=>[...a[14]||(a[14]=[S("span",{class:"unit"},"KG",-1)])]),_:1},8,["modelValue"])]),S("div",Dt,[a[16]||(a[16]=S("div",{class:"label"},"活动时间",-1)),v(D,{title:"开始时间",value:t.startTime||"请选择","is-link":"",onClick:a[5]||(a[5]=c=>l.value=!0)},null,8,["value"]),v(D,{title:"结束时间",value:t.endTime||"请选择","is-link":"",onClick:a[6]||(a[6]=c=>i.value=!0)},null,8,["value"])]),S("div",Vt,[v(E,{type:"primary",block:"","native-type":"submit"},{default:A(()=>[...a[17]||(a[17]=[ce(" 发布活动 ",-1)])]),_:1})])]),_:1}),v(m,{show:l.value,"onUpdate:show":a[8]||(a[8]=c=>l.value=c),position:"bottom"},{default:A(()=>[v(s,{title:"选择开始时间",onConfirm:h,onCancel:a[7]||(a[7]=c=>l.value=!1)})]),_:1},8,["show"]),v(m,{show:i.value,"onUpdate:show":a[10]||(a[10]=c=>i.value=c),position:"bottom"},{default:A(()=>[v(s,{title:"选择结束时间",onConfirm:g,onCancel:a[9]||(a[9]=c=>i.value=!1)})]),_:1},8,["show"])])}}},$t=Me(St,[["__scopeId","data-v-ccca348e"]]);export{$t as default};
