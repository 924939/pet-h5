import{_ as O,r as u,aa as P,k as x,A as U,ap as Y,b as n,e as s,q as k,N as S,j as o,F as j,i as q,f as z,o as i}from"./index-XQHuw6kS.js";const L={class:"ck-page"},W={class:"ck-card"},G={class:"ck-status"},H={class:"st-left"},J={class:"st-big"},K={class:"st-row"},Q={class:"pill"},X={class:"pill subtle"},Z={class:"st-right"},ss={class:"total"},ts={class:"t-val"},es={class:"week week-compact"},as={class:"week-head"},os={class:"wh-sub"},ns={class:"week-strip"},is={key:0,class:"shine"},cs={class:"mini-top"},ds={class:"dow"},ls={key:0,class:"bonus-tag"},rs={class:"date"},us={class:"mini-bottom"},vs={class:"mark"},_s={key:0,class:"ok"},ps={key:1,class:"no"},hs={class:"reward"},ks=["disabled"],gs={key:0},ys={key:1},ms={key:2,class:"burst","aria-hidden":"true"},ws={key:0,class:"toast"},v=10,g=30,fs={__name:"index",setup(bs){const l=u(!1),y=u(!1),c=P({show:!1,text:"",t:null}),m=(t,e=1600)=>{c.text=t,c.show=!0,clearTimeout(c.t),c.t=setTimeout(()=>c.show=!1,e)},d=u(!1),w=u(3),f=u(18),$=async()=>(await new Promise(t=>setTimeout(t,260)),{todaySigned:!1,streak:3,totalSigned:18,signedIndices:[0,1,2]}),A=async()=>(await new Promise(t=>setTimeout(t,520)),{ok:!0}),_=new Date,T=_.getDay(),C=T===0?-6:1-T,b=new Date(_);b.setDate(_.getDate()+C);const p=t=>String(t).padStart(2,"0"),h=u([]),D=x(()=>{const t=_.getDay();return t===0?6:t-1}),I=x(()=>{const t=[],e=["一","二","三","四","五","六","日"];for(let a=0;a<7;a++){const r=new Date(b);r.setDate(b.getDate()+a);const E=a===D.value,F=h.value.includes(a),R=a===6?v+g:v,V=`${r.getFullYear()}-${p(r.getMonth()+1)}-${p(r.getDate())}`;t.push({key:V,index:a,dow:`周${e[a]}`,date:`${p(r.getMonth()+1)}/${p(r.getDate())}`,isToday:E,signed:F,reward:R})}return t}),B=x(()=>D.value===6?v+g:v),N=()=>{y.value=!0,setTimeout(()=>y.value=!1,450)},M=async()=>{if(!(d.value||l.value))try{l.value=!0;const t=await A();if(t?.ok){d.value=!0,w.value+=1,f.value+=1;const e=D.value;h.value.includes(e)||h.value.push(e),m(`签到成功 +${B.value} 积分`),N()}else m(t?.message||"签到失败，请稍后重试")}catch{m("网络异常，请稍后重试")}finally{l.value=!1}};return U(async()=>{const t=await $();d.value=t.todaySigned,w.value=t.streak,f.value=t.totalSigned,h.value=t.signedIndices||[]}),Y(()=>{clearTimeout(c.t)}),(t,e)=>(i(),n("div",L,[s("div",W,[e[5]||(e[5]=s("div",{class:"ck-head"},[s("div",{class:"ck-title"},"每日签到"),s("div",{class:"ck-sub"},"坚持签到，喂养能量会持续增长")],-1)),s("div",G,[s("div",H,[s("div",J,[s("span",{class:S(["st-flag",{on:d.value}])},o(d.value?"已签到":"未签到"),3)]),s("div",K,[s("div",Q,"连续 "+o(w.value)+" 天",1),s("div",X,"今日 +"+o(B.value)+" 积分",1)])]),s("div",Z,[s("div",ss,[e[0]||(e[0]=s("div",{class:"t-label"},"累计签到",-1)),s("div",ts,o(f.value)+" 天",1)])])]),s("div",es,[s("div",as,[e[1]||(e[1]=s("div",{class:"wh-title"},"本周签到",-1)),s("div",os,"周日 +"+o(v+g),1)]),s("div",ns,[(i(!0),n(j,null,q(I.value,a=>(i(),n("div",{key:a.key,class:S(["day-mini",{done:a.signed,today:a.isToday,bonus:a.index===6}])},[a.signed?(i(),n("span",is)):k("",!0),s("div",cs,[s("span",ds,o(a.dow),1),a.index===6?(i(),n("span",ls,"加成")):k("",!0)]),s("div",rs,o(a.date),1),s("div",us,[s("span",vs,[a.signed?(i(),n("span",_s,"✓")):(i(),n("span",ps,"•"))]),s("span",hs,"+"+o(a.reward),1)])],2))),128))])]),s("button",{class:S(["btn",{disabled:d.value||l.value}]),disabled:d.value||l.value,onClick:M},[l.value?(i(),n("span",ys,"签到中…")):(i(),n("span",gs,o(d.value?"今日已签到":"一键签到"),1)),y.value?(i(),n("span",ms,[...e[2]||(e[2]=[z('<i class="p p1" data-v-1e770298></i><i class="p p2" data-v-1e770298></i><i class="p p3" data-v-1e770298></i><i class="p p4" data-v-1e770298></i><i class="p p5" data-v-1e770298></i>',5)])])):k("",!0)],10,ks),s("div",{class:"rules compact"},[e[3]||(e[3]=s("div",{class:"r-title"},"奖励规则",-1)),s("div",{class:"r-item"},"每日签到 +"+o(v)+"，周日额外 +"+o(g)),e[4]||(e[4]=s("div",{class:"r-item"},"连续签到会更稳定（后续可做阶梯加成）",-1))])]),c.show?(i(),n("div",ws,o(c.text),1)):k("",!0)]))}},xs=O(fs,[["__scopeId","data-v-1e770298"]]);export{xs as default};
