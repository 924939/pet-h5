import{_ as S,r as p,aa as U,k as x,ap as A,b as i,e as t,q as y,J as I,aO as N,N as T,j as h,o as d}from"./index-XQHuw6kS.js";const O={class:"bp-page"},j={class:"bp-card"},q={class:"bp-field"},z={class:"bp-input-row"},J=["disabled"],M={key:0},$={key:1},F={key:0,class:"bp-error"},G={class:"bp-field"},H={key:0,class:"bp-error"},K=["disabled"],L={key:0},Q={key:1},R={key:0,class:"bp-toast"},W={__name:"index",setup(X){const l=p(""),a=p(""),r=p(""),v=p(""),o=p(0);let b=null;const n=p(!1),u=U({show:!1,text:"",t:null}),c=(s,e=1800)=>{u.text=s,u.show=!0,clearTimeout(u.t),u.t=setTimeout(()=>u.show=!1,e)},m=s=>/^1\d{10}$/.test(s),k=s=>s.replace(/\D/g,""),_=()=>{l.value=k(l.value).slice(0,11),l.value.length===0?r.value="":!m(l.value)&&l.value.length===11?r.value="手机号格式不正确":r.value=""},g=()=>{a.value=k(a.value).slice(0,6),a.value.length===0?v.value="":a.value.length<6?v.value="请输入 6 位验证码":v.value=""},w=x(()=>m(l.value)&&o.value===0&&!n.value),C=x(()=>m(l.value)&&a.value.length===6),B=(s=60)=>{o.value=s,clearInterval(b),b=setInterval(()=>{o.value-=1,o.value<=0&&(o.value=0,clearInterval(b),b=null)},1e3)},P=async s=>(await new Promise(e=>setTimeout(e,600)),{ok:!0}),V=async({phoneNum:s,smsCode:e})=>(await new Promise(f=>setTimeout(f,800)),{ok:!0}),D=async()=>{if(_(),!m(l.value)){r.value="请输入正确的手机号";return}if(!(o.value>0))try{n.value=!0;const s=await P(l.value);s?.ok?(c("验证码已发送"),B(60)):c(s?.message||"发送失败，请稍后重试")}catch{c("网络异常，请稍后重试")}finally{n.value=!1}},E=async()=>{if(_(),g(),!m(l.value)){r.value="请输入正确的手机号";return}if(a.value.length!==6){v.value="请输入 6 位验证码";return}try{n.value=!0;const s=await V({phoneNum:l.value,smsCode:a.value});s?.ok?c("绑定成功"):c(s?.message||"绑定失败，请重试")}catch{c("网络异常，请稍后重试")}finally{n.value=!1}};return A(()=>{clearInterval(b),clearTimeout(u.t)}),(s,e)=>(d(),i("div",O,[t("div",j,[e[5]||(e[5]=t("div",{class:"bp-title"},"绑定手机号",-1)),e[6]||(e[6]=t("div",{class:"bp-sub"},"绑定后可用于账号安全验证与喂养记录同步",-1)),t("div",q,[e[2]||(e[2]=t("div",{class:"bp-label"},"手机号",-1)),t("div",z,[I(t("input",{class:"bp-input",type:"tel",inputmode:"numeric",maxlength:"11",placeholder:"请输入手机号","onUpdate:modelValue":e[0]||(e[0]=f=>l.value=f),onInput:_},null,544),[[N,l.value]]),t("button",{class:T(["bp-code-btn",{disabled:!w.value}]),disabled:!w.value,onClick:D},[o.value===0?(d(),i("span",M,"发送验证码")):(d(),i("span",$,h(o.value)+"s 后重试",1))],10,J)]),r.value?(d(),i("div",F,h(r.value),1)):y("",!0)]),t("div",G,[e[3]||(e[3]=t("div",{class:"bp-label"},"验证码",-1)),I(t("input",{class:"bp-input",type:"tel",inputmode:"numeric",maxlength:"6",placeholder:"请输入 6 位验证码","onUpdate:modelValue":e[1]||(e[1]=f=>a.value=f),onInput:g},null,544),[[N,a.value]]),v.value?(d(),i("div",H,h(v.value),1)):y("",!0),e[4]||(e[4]=t("div",{class:"bp-tip"},"没收到？检查短信拦截，或稍后重试",-1))]),t("button",{class:T(["bp-submit",{disabled:!C.value||n.value}]),disabled:!C.value||n.value,onClick:E},[n.value?(d(),i("span",Q,"绑定中…")):(d(),i("span",L,"确认绑定"))],10,K),e[7]||(e[7]=t("div",{class:"bp-footer"}," 继续即表示你同意我们使用该手机号用于账号验证与安全保护 ",-1))]),u.show?(d(),i("div",R,h(u.text),1)):y("",!0)]))}},Z=S(W,[["__scopeId","data-v-bfcba493"]]);export{Z as default};
