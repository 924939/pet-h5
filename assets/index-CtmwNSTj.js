import{q as ne,d as ae,t as le,m as ie,s as re,c as de,r as l,v as ce,k as A,x as F,y as ue,z as D,A as ve,a as n,B as fe,C as N,D as pe,w as me,E as _e,_ as ge,b,e,G as he,h as g,j as a,g as m,I as ke,J as ye,u as we,o as h,F as V,i as M,K as be,p as E,L as $,M as j}from"./index-DQr7aEFG.js";import{u as xe,S as Te,P as Ce,a as Se,F as Pe}from"./mount-component-D3KnWaYU.js";import{L as Re,B as Ae}from"./index-FV5H6iOe.js";import{s as z}from"./function-call-CXHSr0q4.js";import{C as Ke}from"./index-BmTA_o9p.js";import{P as Be}from"./index-B3h8kp63.js";const Le=Symbol(),Ve=()=>ne(Le,null),[Me,x,Ee]=de("list"),je={error:Boolean,offset:re(300),loading:Boolean,disabled:Boolean,finished:Boolean,scroller:Object,errorText:String,direction:ie("down"),loadingText:{type:String,default:""},finishedText:String,immediateCheck:le};var Ie=ae({name:Me,props:je,emits:["load","update:error","update:loading"],setup(o,{emit:d,slots:r}){const c=l(o.loading),k=l(),K=l(),y=Ve(),p=ce(k),T=A(()=>o.scroller||p.value),u=()=>{fe(()=>{if(c.value||o.finished||o.disabled||o.error||y?.value===!1)return;const{direction:i}=o,v=+o.offset,f=N(T);if(!f.height||pe(k))return;let _=!1;const P=N(K);i==="up"?_=f.top-P.top<=v:_=P.bottom-f.bottom<=v,_&&(c.value=!0,d("update:loading",!0),d("load"))})},C=()=>{if(o.finished){const i=r.finished?r.finished():o.finishedText;if(i)return n("div",{class:x("finished-text")},[i])}},S=()=>{d("update:error",!1),u()},B=()=>{if(o.error){const i=r.error?r.error():o.errorText;if(i)return n("div",{role:"button",class:x("error-text"),tabindex:0,onClick:S},[i])}},L=()=>{if(c.value&&!o.finished&&!o.disabled)return n("div",{class:x("loading")},[r.loading?r.loading():o.loadingText!=null&&n(Re,{class:x("loading-icon")},{default:()=>[o.loadingText||Ee("loading")]})])};return F(()=>[o.loading,o.finished,o.error],u),y&&F(y,i=>{i&&u()}),ue(()=>{c.value=o.loading}),D(()=>{o.immediateCheck&&u()}),xe({check:u}),ve("scroll",u,{target:T,passive:!0}),()=>{var i;const v=(i=r.default)==null?void 0:i.call(r),f=n("div",{ref:K,class:x("placeholder")},null);return n("div",{ref:k,role:"feed",class:x(),"aria-busy":c.value},[o.direction==="down"?v:f,L(),C(),B(),o.direction==="up"?v:f])}}});const Ue=me(Ie),Fe=_e("support",{state:()=>({rewards:[{key:"p",label:"100 积分",amount:10,foodKg:2,foodType:"狗粮",count:1},{key:"10",label:"¥10",amount:10,foodKg:2,foodType:"狗粮",count:1},{key:"20",label:"¥20",amount:20,foodKg:4,foodType:"猫粮",count:1},{key:"30",label:"¥20",amount:20,foodKg:4,foodType:"猫粮",count:1},{key:"40",label:"¥20",amount:20,foodKg:4,foodType:"猫粮",count:1},{key:"50",label:"¥20",amount:20,foodKg:4,foodType:"猫粮",count:1},{key:"60",label:"¥20",amount:20,foodKg:4,foodType:"猫粮",count:1}],selectedKey:"p"}),getters:{selectedReward(o){return o.rewards.find(d=>d.key===o.selectedKey)},totalAmount(){return this.selectedReward?this.selectedReward.amount*this.selectedReward.count:0}},actions:{selectReward(o){this.selectedKey=o.key},changeCount(o,d){o.count+d<1||(o.count+=d)}}}),Ne=["src"],$e={class:"card"},ze={class:"title-row"},De={class:"title"},Ge={class:"auth"},Xe={class:"progress-info"},Ye={class:"money"},qe={class:"percent"},He={class:"support-count"},Je={class:"card"},Oe={class:"desc"},Qe={class:"card"},We={class:"verify-header"},Ze={class:"card"},et=["src"],tt={class:"support-info"},ot={class:"support-top"},st={class:"nickname"},nt={class:"level"},at={class:"amount"},lt={class:"comment"},it={class:"bottom-bar"},rt={class:"popup"},dt={class:"popup-content"},ct={class:"points"},ut=["onClick"],vt={class:"reward-price"},ft={class:"reward-food"},pt={class:"donate-bar"},mt={class:"donate-info"},_t={class:"donate-amount"},gt={__name:"index",setup(o){const d=we(),r=Fe(),c=l(null),k=l(!1),K=()=>{k.value=c.value.scrollTop>400},y=()=>{c.value.scrollTo({top:0,behavior:"smooth"})},p=l({name:"流浪动物救助基地",targetAmount:5e4,currentAmount:18600,desc:"基地长期致力于流浪动物的救助、治疗和领养。",images:["https://picsum.photos/400/300?1","https://picsum.photos/400/300?2"]}),T=l(p.value.currentAmount),u=A(()=>Math.floor(T.value/p.value.targetAmount*100)),C=l([]),S=l(!1),B=l(!1),L=l(48),i=()=>{setTimeout(()=>{C.value.push(...new Array(10).fill(0).map(()=>({avatar:"https://fastly.jsdelivr.net/npm/@vant/assets/cat.jpeg",nickname:"爱心用户",level:Math.ceil(Math.random()*6),amount:[10,20,30][Math.floor(Math.random()*3)],comment:"愿毛孩子都能被温柔以待"}))),S.value=!1,C.value.length>=L.value&&(B.value=!0)},600)},v=l(!1),f=l(""),_=l(!1),P=l(null),G=l(320),X=A(()=>r.rewards),Y=A(()=>r.selectedKey),q=A(()=>r.totalAmount),H=r.selectReward,I=r.changeCount,J=()=>{if(!_.value){z({message:"请先阅读并同意公益支持协议",duration:2e3}),P.value?.scrollIntoView({behavior:"smooth",block:"center"});return}d.push("/project")},O=()=>{z("查看认证详情")};return D(i),(ht,t)=>{const Q=Se,W=Te,R=ke,Z=Be,ee=Ue,U=Ae,te=Pe,oe=Ke,se=Ce;return h(),b("div",{class:"detail-page",ref_key:"pageRef",ref:c,onScrollPassive:K},[n(W,{class:"swipe",autoplay:3e3,"indicator-color":"#ff7a00"},{default:g(()=>[(h(!0),b(V,null,M(p.value.images,(s,w)=>(h(),be(Q,{key:w},{default:g(()=>[e("img",{src:s,class:"swipe-img"},null,8,Ne)]),_:2},1024))),128))]),_:1}),e("div",$e,[e("div",ze,[e("div",De,a(p.value.name),1),e("div",Ge,[n(R,{name:"passed",color:"#07c160"}),t[6]||(t[6]=m(" 已认证 ",-1))])]),e("div",Xe,[e("div",Ye,[m(" ¥"+a(T.value)+" ",1),e("span",null,"/ ¥"+a(p.value.targetAmount),1)]),e("div",qe,a(u.value)+"%",1)]),n(Z,{percentage:u.value,"stroke-width":"8",color:"#ff7a00","pivot-text":""},null,8,["percentage"]),e("div",He,a(L.value)+" 人已支持",1)]),e("div",Je,[t[7]||(t[7]=e("div",{class:"card-title"},"基地介绍",-1)),e("div",Oe,a(p.value.desc),1)]),e("div",Qe,[e("div",We,[n(R,{name:"certificate",color:"#07c160"}),t[8]||(t[8]=m(" 基地真实性认证 ",-1))]),t[9]||(t[9]=e("div",{class:"verify-row"},[e("span",null,"认证机构"),e("span",null,"XX 市公益动物保护协会")],-1)),t[10]||(t[10]=e("div",{class:"verify-row"},[e("span",null,"备案编号"),e("span",null,"GY-2024-0821")],-1)),t[11]||(t[11]=e("div",{class:"verify-tip"},"平台已对基地主体、救助能力进行人工审核",-1)),e("div",{class:"verify-link",onClick:O},"查看认证详情 →")]),e("div",Ze,[t[12]||(t[12]=e("div",{class:"card-title"},"支持记录",-1)),n(ee,{loading:S.value,"onUpdate:loading":t[0]||(t[0]=s=>S.value=s),finished:B.value,"finished-text":"没有更多了",onLoad:i},{default:g(()=>[(h(!0),b(V,null,M(C.value,(s,w)=>(h(),b("div",{key:w,class:"support-item"},[e("img",{src:s.avatar,class:"avatar"},null,8,et),e("div",tt,[e("div",ot,[e("span",st,a(s.nickname),1),e("span",nt,"Lv"+a(s.level),1),e("span",at,"¥"+a(s.amount),1)]),e("div",lt,a(s.comment),1)])]))),128))]),_:1},8,["loading","finished"])]),t[20]||(t[20]=e("div",{class:"van-safe-area-bottom"},null,-1)),he(e("div",{class:"back-top",onClick:y},[n(R,{name:"arrow-up"})],512),[[ye,k.value]]),e("div",it,[n(U,{type:"warning",round:"",block:"",onClick:t[1]||(t[1]=s=>v.value=!0)},{default:g(()=>[...t[13]||(t[13]=[m(" 支持一下 ",-1)])]),_:1})]),n(se,{show:v.value,"onUpdate:show":t[5]||(t[5]=s=>v.value=s),position:"bottom",style:{height:"60%"},round:""},{default:g(()=>[e("div",rt,[e("div",dt,[t[16]||(t[16]=e("div",{class:"popup-title"},"支持基地",-1)),e("div",ct,[t[14]||(t[14]=m(" 我的积分：",-1)),e("b",null,a(G.value),1)]),(h(!0),b(V,null,M(X.value,s=>(h(),b("div",{key:s.key,class:$(["reward",{active:Y.value===s.key}]),onClick:w=>E(H)(s)},[e("div",null,[e("div",vt,a(s.label),1),e("div",ft," ≈ "+a(s.foodKg)+"kg "+a(s.foodType),1)]),e("div",{class:"count",onClick:t[2]||(t[2]=j(()=>{},["stop"]))},[n(R,{name:"minus",class:$({disabled:s.count<=1}),onClick:j(w=>E(I)(s,-1),["stop"])},null,8,["class","onClick"]),e("span",null,a(s.count),1),n(R,{name:"plus",onClick:j(w=>E(I)(s,1),["stop"])},null,8,["onClick"])])],10,ut))),128)),n(te,{modelValue:f.value,"onUpdate:modelValue":t[3]||(t[3]=s=>f.value=s),type:"textarea",rows:"2",autosize:"",placeholder:"说点鼓励的话（可选）"},null,8,["modelValue"]),e("div",{class:"agreement",ref_key:"agreementRef",ref:P},[n(oe,{modelValue:_.value,"onUpdate:modelValue":t[4]||(t[4]=s=>_.value=s),"checked-color":"#fb976d"},{default:g(()=>[...t[15]||(t[15]=[m(" 我已阅读并同意 ",-1),e("span",{class:"link"},"《公益支持协议》",-1)])]),_:1},8,["modelValue"])],512)]),e("div",pt,[e("div",mt,[t[18]||(t[18]=e("div",{class:"donate-label"},"合计支持",-1)),e("div",_t,[t[17]||(t[17]=m(" ¥",-1)),e("span",null,a(q.value),1)])]),n(U,{class:"donate-btn",type:"warning",round:"",onClick:J},{default:g(()=>[...t[19]||(t[19]=[m(" 确认支持 ",-1)])]),_:1})])])]),_:1},8,["show"])],544)}}},Ct=ge(gt,[["__scopeId","data-v-c575bc2c"]]);export{Ct as default};
